{"data":{"wordpressPost":{"title":"Time Shift Cross Correlation of Two Time Series Matlab","content":"<html><head></head><body><p>One of the most basic techniques to quantify the changes between two time series is to determine the cross correlation index (CCI). In the context of damage detection, if you have a reference signal (baseline) and some time later you obtain a new signal from the same source/transmitter arrangement, you are able to quantify changes in the signal. Out of the box application for cross correlation takes two inputs and returns one output which is the index of similarity, namely (CCI).</p>\n<p>If you&#x2019;re doing research, it may be a good idea to stay away from basic techniques as they are not state of the art. However, for this post, I will demonstrate a slightly improved algorithm for cross correlation to uncover temporal variations in the time series data, called Time Shift Cross Correlation or Local Peak Coherence.</p>\n<p>Instead of using the entire signal as an input for cross correlation, the signal is segmented into N windows with length T. Therefore, by calculating the CCI for each time window, you will obtain CCI with respect to time. It may be useful if you&#x2019;re trying to detect irregularities in certain section of a signal.</p>\n<p>The cross-correlation with window length T and at particular time is given by:</p>\n<p><div class=\" gatsby-image-wrapper\" style=\"position:relative;overflow:hidden;max-width:100%;width:300px\" data-reactroot><div style=\"width:100%;padding-bottom:10.945709281961472%\"></div><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMABJPgAAST4AGIAg1vAAAASElEQVQI12XNSQ6AIBBE0XICHJBEd9z/oP42tVKSl9CzJM3YcWPDgoIJCdk9ybXR8ar/i7l3SUdz4sTl/+FDMVwtW+SHz8L6AGCMAUSpz3eDAAAAAElFTkSuQmCC\" alt style=\"position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition:opacity 0.5s;transition-delay:0.25s\"><picture><img sizes=\"(max-width: 300px) 100vw, 300px\" srcset=\"/static/b31fb50e59edb256daa5882133909058/c14e1/post2_eq1.png 75w,\n/static/b31fb50e59edb256daa5882133909058/d4214/post2_eq1.png 150w,\n/static/b31fb50e59edb256daa5882133909058/135ae/post2_eq1.png 300w,\n/static/b31fb50e59edb256daa5882133909058/44727/post2_eq1.png 450w,\n/static/b31fb50e59edb256daa5882133909058/34e8a/post2_eq1.png 600w,\n/static/b31fb50e59edb256daa5882133909058/fea0e/post2_eq1.png 900w,\n/static/b31fb50e59edb256daa5882133909058/a4b20/post2_eq1.png 1142w\" src=\"/static/b31fb50e59edb256daa5882133909058/135ae/post2_eq1.png\" alt style=\"position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition:opacity 0.5s\"></picture><noscript><picture><img sizes=\"(max-width: 300px) 100vw, 300px\" srcset=\"/static/b31fb50e59edb256daa5882133909058/c14e1/post2_eq1.png 75w,\n/static/b31fb50e59edb256daa5882133909058/d4214/post2_eq1.png 150w,\n/static/b31fb50e59edb256daa5882133909058/135ae/post2_eq1.png 300w,\n/static/b31fb50e59edb256daa5882133909058/44727/post2_eq1.png 450w,\n/static/b31fb50e59edb256daa5882133909058/34e8a/post2_eq1.png 600w,\n/static/b31fb50e59edb256daa5882133909058/fea0e/post2_eq1.png 900w,\n/static/b31fb50e59edb256daa5882133909058/a4b20/post2_eq1.png 1142w\" src=\"/static/b31fb50e59edb256daa5882133909058/135ae/post2_eq1.png\" alt=\"\" style=\"position:absolute;top:0;left:0;transition:opacity 0.5s;transition-delay:0.5s;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center\"/></picture></noscript></div></p>\n<p>where omega(t) is a rectangular window, t is time, tau is delay.</p>\n<p>The corresponding estimate of time windowed correlation coefficient function or normalised cross correlation is:</p>\n<p><div class=\" gatsby-image-wrapper\" style=\"position:relative;overflow:hidden;max-width:100%;width:300px\" data-reactroot><div style=\"width:100%;padding-bottom:11.74698795180723%\"></div><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMABJPgAAST4AGIAg1vAAAARUlEQVQI12NgYGDgAmIOIGYHYmYgZoTSbECsAsR8UDEWBvwApIYTxBCCYj6ooSC2BhCrA7EyEOsBsRoQK0ItwQWYQGYAAHVUAbBXNXBNAAAAAElFTkSuQmCC\" alt style=\"position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition:opacity 0.5s;transition-delay:0.25s\"><picture><img sizes=\"(max-width: 300px) 100vw, 300px\" srcset=\"/static/79713286398b5a194f8973cefc153dc4/c14e1/post2_eq2.png 75w,\n/static/79713286398b5a194f8973cefc153dc4/d4214/post2_eq2.png 150w,\n/static/79713286398b5a194f8973cefc153dc4/135ae/post2_eq2.png 300w,\n/static/79713286398b5a194f8973cefc153dc4/44727/post2_eq2.png 450w,\n/static/79713286398b5a194f8973cefc153dc4/34e8a/post2_eq2.png 600w,\n/static/79713286398b5a194f8973cefc153dc4/fea0e/post2_eq2.png 900w,\n/static/79713286398b5a194f8973cefc153dc4/a6f5c/post2_eq2.png 996w\" src=\"/static/79713286398b5a194f8973cefc153dc4/135ae/post2_eq2.png\" alt style=\"position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition:opacity 0.5s\"></picture><noscript><picture><img sizes=\"(max-width: 300px) 100vw, 300px\" srcset=\"/static/79713286398b5a194f8973cefc153dc4/c14e1/post2_eq2.png 75w,\n/static/79713286398b5a194f8973cefc153dc4/d4214/post2_eq2.png 150w,\n/static/79713286398b5a194f8973cefc153dc4/135ae/post2_eq2.png 300w,\n/static/79713286398b5a194f8973cefc153dc4/44727/post2_eq2.png 450w,\n/static/79713286398b5a194f8973cefc153dc4/34e8a/post2_eq2.png 600w,\n/static/79713286398b5a194f8973cefc153dc4/fea0e/post2_eq2.png 900w,\n/static/79713286398b5a194f8973cefc153dc4/a6f5c/post2_eq2.png 996w\" src=\"/static/79713286398b5a194f8973cefc153dc4/135ae/post2_eq2.png\" alt=\"\" style=\"position:absolute;top:0;left:0;transition:opacity 0.5s;transition-delay:0.5s;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center\"/></picture></noscript></div></p>\n<p>If the correlation index is 1, there is no change, corresponding to no damage has occured, and if it&#x2019;s below 1, some changes in the medium has occured. For application in damage detection or structural health monitoring, even with no damage, it is unlikely you will ever get a CCI of 1 due to temperature, loading and moisture variations in the structure. You could either apply compensation algorithms or apply a threshold level.</p>\n<p>Now on to writing the time shift cross correlation algorithm in Matlab.</p>\n<pre><code class=\"language-matlab\">\nfunction [corr, delay, t_interval] = localcoherence(s1,s2,t_win,dt)\n%This function takes in 5 inputs: S1 = Signal 1, S2 = Signal 2,\n%t_win = time window, dt = sampling time\nif nargin~=4\nerror(&apos;4 inputs required&apos;);\nend\ns1_length = length(s1);\ns2_length = length(s2);\nif s1_length ~= s2_length\nif s1_length &gt; s2_length\ns2 = [s2; zeros((s2_length-s1_length),1)];\nelse\ns1= [s1; zeros((s1_length-s2_length),1)];\nend\nend\nN = s1_length;\n%initalise variables\nk = 1;\nR_vec = zeros(1,floor(N/t_win));\nlag_vec = zeros(1,floor(N/t_win));\nt_init = t_win/2:t_win:N;\n\nfor t=1:t_win:N\nif t+t_win &lt; N\ns1_temp = s1(t:t+t_win-1);\ns2_temp = s2(t:t+t_win-1);\n[R, lags]=xcorr(s2_temp,s1_temp,&apos;coeff&apos;); %normalised cross correlation/ local temporal coherence\n[vm, im]=max(R); %max. correlation and index\ns1_lag=lags(im); %delay at max correlation\n%store R and lags into vector\nR_vec(k) = vm;\nlag_vec(k) = s1_lag;\n%increment store vector\nk = k +1;\nend\nend\n\ncorr = R_vec;\ndelay = lag_vec*dt;\nt_interval = t_init*dt;\n\nend\n</code></pre>\n<p>Putting the Matlab function into action. Let&#x2019;s create two sinusodial waves.</p>\n<pre><code class=\"language-matlab\">\nt = 0:1e-8:0.001; f1 = 5000; f2 = 10000;\ns1 = sin(2*pi*f1*t);\ns2 = sin(2*pi*f2*t);\nt_win = 1000;\ndt = 1e-8;\n[corr, delay, t_interval] = localcoherence(s1,s2,t_win,dt);</code></pre>\n<p>Plotting time vs correlation index.</p>\n<pre><code class=\"language-matlab\">subplot(2,1,1)\nplot(t,s1,&apos;LineWidth&apos;,1.5); hold on; plot(t,s2,&apos;LineWidth&apos;,1.5);\nxlabel(&apos;Time (s)&apos;);\nylabel(&apos;Amplitude&apos;);\nlegend(&apos;S1&apos;,&apos;S2&apos;)\nsubplot(2,1,2)\nplot(t_interval, corr,&apos;LineWidth&apos;,2);\nxlabel(&apos;Time (s)&apos;);\nylabel(&apos;CC Index&apos;);</code></pre>\n<p>There you have it, a Time Shift Cross Correlation/Normalised Cross Correlation/Peak Coherence algorithm. I also have a python version of this algorithm in which I&#x2019;ll post if requested.</p>\n<p>Feel free contact me, if you have found a bug in the code.</p>\n</body></html>","date":"2019-04-27T21:51:01.000Z","slug":"time-shift-cross-correlation-of-two-time-series-matlab","acf":{"readingDuration":"7 min","gist_text":null},"categories":[{"name":"Article"}],"featured_media":{"localFile":{"childImageSharp":{"fluid":{"src":"/static/0017bd90ae5121a52cf7b6d46e48dc30/c2a4f/timeseriescccover.png"}}}}},"site":{"siteMetadata":{"title":"JOHN PHUNG","description":"Researcher, Designer, Developer & Entrepreneur","author":"John Phung","url":"https://johnphung.tech","twitterHandle":"@jphungme"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"97dc3ec3-70f9-555c-9248-77dfce6a4917"}}